{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<h1>Welcome to Sunberry!</h1>
<p>
  This website is hosted on a 100% photovoltaics powered server.
</p>
<div class="chart-container" style="position: relative; height:40vh; width: 100%;">
  <canvas id="myChart"></canvas>
</div>
<p>
  GitHub repository:
  <a href="https://github.com/felixmark/sunberry">https://github.com/felixmark/sunberry</a>
</p>

<script src="/static/js/chart.js"></script>
<script>
  const ctx = document.getElementById('myChart');

  let chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [1, 2, 3, 4, 5, 6],
      datasets: [{
        label: 'Power used (W)',
        data: null,
        borderWidth: 3,
        borderColor: "#559598",
        backgroundColor: "#55959840",
        fill: true,
      }, {
        label: 'Photovoltaic power (W)',
        data: [0, 3, 20, 14, 5, 0],
        borderWidth: 3,
        borderColor: "#d79921",
        backgroundColor: "#d7992120",
        fill: true,
      }],
    },
    options: {
      interaction: {
        intersect: false,
        mode: 'index',
      },
      scales: {
        y: {
          max: 22,
        }
      },
      maintainAspectRatio: false,
      cubicInterpolationMode: 'monotone',
      tension: 0.5,
      pointRadius: 0,
      pointHitRadius: 20,
      plugins: {
        legend: {
          labels: {
            usePointStyle: true,
            boxHeight: 7,
          }
        },
        tooltip: {
          usePointStyle: true,
          multiKeyBackground: "#00000000"
        }
      }
    }
  });

  const dbDataRequest = new Request("api/v1/db_data?from=13.06.2024&to=13.06.2024");
  fetch(dbDataRequest).then((response) => {
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
    return response.json()
  }).then((dbDataObject) => {
    power_used = dbDataObject["power_used"];
    chart.data.datasets[0].data = power_used;
    chart.update();
  });
</script>
{% endblock %}